# NIST Guest Researcherとしての米国勤務を終えて

[2019年3月に渡米](/20190526_settle_in_the_us.md)し、米国メリーランド州で[NIST](https://www.nist.gov/)のGuest Researcherとして研究活動を行なってきた。当初は1年の予定だったが、様々な理由から1年半延長したことによって、COVID-19パンデミック、TOKYO2020の延期開催、大統領選挙、17年ゼミBrood X襲来なども含め、2021年9月末までの間に仕事・生活の両面で様々な経験を積むことができた。これらの経験は今後誰かの役に立つかもしれないので、ここであらためて振り返ってまとめておく。

## 1. NISTでの研究
研究内容はそれぞれのリンク先等を参照してもらうものとして、ここでは研究の過程などを中心に記述する。全ての研究活動はNIST内のレポジトリで逐次共有し、ミーティングでもいつもMarkdownを見せながら文章と図で説明していたし、様々なツールや環境がすぐに利用できるのもとても快適な環境だった。

* An Empirical Study on Flow-based Botnet Attacks Prediction ([NIST TN 2111](https://csrc.nist.gov/publications/detail/white-paper/2020/10/22/an-empirical-study-on-flow-based-botnet-attacks-prediction/final))

  ボットネットのC2サーバのトラフィックを、ISPバックボーンのフローデータを用いて分析することで、ボットネットによる攻撃の予兆を検知する研究。IoTの普及に伴って脆弱な機器がインターネットに多数接続することによりボットネットの脅威があらためて深刻になっていた。2017年3月の大統領令[EO 13800]を受けて、2018年5月にDoCとDHS連名で発行した通称[Botnet Report](https://csrc.nist.gov/publications/detail/white-paper/2018/05/30/enhancing-resilience-against-botnets--report-to-the-president/final)などを踏まえ、スーパーバイザーのサポートのもと、研究テーマの立案から一人称で行なった。DivisionやGroupを超えて有識者にアイデアを紹介し、フィードバックをもらって方向性を定めるとともに、データ収集・分析のシステムの実装を並行して進めた。Deep Learningの適用とGPUクラスタの利用、ボットネットに関わる攻撃データをもとにしたアノテーションの自動化、Explainable AIとしての評価など、多くの新たなチャレンジもできた。日本では2021年10月5日に総務省から[「電気通信事業におけるサイバー攻撃への適正な対処の在り方に関する研究会　第四次とりまとめ」及び意見募集の結果の公表](https://www.soumu.go.jp/menu_news/s-news/01kiban18_01000134.html)が発表された。これは平時におけるフロー情報の収集・蓄積・分析によるC&Cサーバである可能性が高い機器の検知、フロー情報を収集・蓄積・分析して検知したC&Cサーバに関する情報についての共有などについての、通信の秘密の利用等に関する違法性阻却の考え方をまとめたものである。NISTでの研究成果が、国内でも活用していく布石になれば幸いだ。

* An Evaluation Design for Comparing Netflow Based Network Anomaly Detection Systems Using Synthetic Malicious Traffic([NIST TN 2142](https://www.nist.gov/publications/evaluation-design-comparing-netflow-based-network-anomaly-detection-systems-using))

  前述の研究の過程で議論したメンバから、コラボレーションの依頼があり、並行して取り組んだ。アノマリとなる攻撃データの合成、正常データとの混合、機械学習を用いた複数のアノマリ検知システムの比較評価を含む、フローベースのアノマリ検知システムの評価フレームワークを提案するものである。意見の食い違いも度々あり何度も議論したのは今となっては楽しい思い出である。攻撃データのパターンがDoSとかScanとかレガシーなものしかもともと合成していなかったので、ボットによる攻撃シミュレータ[BotSim](https://github.com/usnistgov/BotSim)を作った。そして、このTNの拡張としてBotSimも含めて研究成果をNIST在籍中にジャーナル投稿。ろくにリファクタリングもせずに公開するのは忍びなかったが、投稿段階で公開しておくべしという推しに負けて公開した。ちゃんと実装があるということを示す価値はあるかなと思う。

* CCE - SP800-53 mapping

  [Common Configuration Enumeration (CCE)](https://ncp.nist.gov/cce)は各種システムをセキュアに保つための共通的な設定の一覧であり、具体的なもの。[SP800-53](https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final)は米国の連邦政府が遵守すべき情報システムと組織のセキュリティとプライバシーの管理策であり、抽象的なもの。ガイドラインへの準拠状況を実装レベルで把握できるようにするために、各CCEとSP800-53の各管理策の対応付け（マッピング）を提供している。前述の研究がひと段落する頃、せっかくNISTにいるのだからとNISTならではのテーマに取り組みたいと思い、NVDのチームに混ぜてもらって、ちょっとやってみてと依頼されたのがこのマッピング。SP1800-19CのVMware Hybrid Cloud Infrastructureと、MacOSについてマッピングを行ったが、個々のプロダクトの機能の詳細知識が必要となり、マニュアルなども読み漁った。しかもN:Nのマッピングになるし、正解かどうかがわからない。そこで、マッピング結果の蓄積、キーワード検索、候補リストアップを行うインタラクティブなコマンドラインツールを作った。一貫性あるマッピングを複数名でやっていくためにはナレッジの蓄積とツール化が必要だと考える。ある程度マッピング結果が蓄積されていけば、NLP/MLを用いたリコメンデーションも可能となるだろうと思う。マッピングを通して、CCEやSP800-53への改善点をフィードバックしたり、NIST IR 8278のOLIR(Online Informative Refferences)による関係性の表記もとり入れたり、と興味深い仕事だった。

* NVD Analysis

  NVD分析チームが日々どんな環境で何をやっているかレクチャをしてもらった。NVDの透明性を担保するため、MITREやベンダから特別な情報提供を受けたりしていない、というのが最も驚いたことかもしれない。その上で、開発環境で約1.5ヶ月間かけてアナリストたちと同じようにMITREからの[CVEデータ](https://github.com/CVEProject/cvelist)に対して、参考情報の確認・追加、[CVSS](https://nvd.nist.gov/vuln-metrics/cvss)算出、[CWE](https://cwe.mitre.org/)特定、[CPE](https://csrc.nist.gov/projects/security-content-automation-protocol/specifications/cpe)特定をやってみた。大きくは3種類の課題をまとめ、メンバとディスカッションを行って、直近でも役立ちそうなCPE特定の自動化に向けた研究に着手することとした。まずは、[CVEデータ](https://github.com/CVEProject/cvelist)のJSONからCPEの元となるデータを自動的に抽出できるかどうか、想定されてる箇所にどんなデータが登録されているかを調査した上で、編集距離による類似度を用いた検索や、自然言語処理と機械学習を用いた他クラス分類、といった手法を試してみた。結果としては約88%の正答率で候補となる部分CPE群を導くことができた。また、この過程でCPE辞書の一括メンテナンスに応用できるノウハウや、自動化することでの一貫性あるCPE特定、そして入出力データ品質の継続的な評価の重要性が低減できたことも、具体的にNVDチームの役に立ったといえる。

帰国後には、ありがたいことにこれらの経験を共有する機会をいただいた。少なからずNISTが身近になったのではないかと密かに期待している。

  * [NCA Annual Conference 2021での基調講演](https://annualconf.nca.gr.jp/)

  * [MWS 2021ポストミーティングでの講演](http://www.iwsec.org/mws/2021/files/mws2021_PhD2NIST_hatada.pdf)


## 2. 趣味の広がり

* サッカー

  在米中、[Samurai Kids](https://samuraikids.wixsite.com/home)はサッカーだけでなく、ゴルフやBBQなどレジャーに限らず、生活面で必要な情報を教えてもらったり様々な面で貴重な場だった。メリーランド州モンゴメリー郡のリーグ戦に参戦しており、企業や研究機関の日本人中心に、結構ガチなサッカーができたのも思い出深い。新規メンバー募集のため、ホームページの立ち上げ、SNSの運用、掲示板への書き込みなど、ソーシャル面もアクティブに貢献できたと思う。チーム内の結果だけだが、得点王1回、アシスト王1回、投票によるMVPにも2回輝くことができ素直に嬉しかったし、40歳を過ぎてもまだこれだけ動けて、こういう経験ができることに喜びを感じた。

* ゴルフ

  COVID-19パンデミックで各種行動が制限される中、少人数かつオープンエアということでゴルフはほとんど制限もなく、これを機会にガッツリ始めた。最寄りのゴルフ場が車で20分だし、1時間圏内だとかなりの数のゴルフ場に行ける。ゴルフをする格好のまま行き、ゴルフバッグを担いでラウンド、というのが当たり前。上手い人たちからアドバイスもいただき、2020年8月に99で100切り達成し、9月:95、10月:90、11月:88と快調にベストスコアを更新。初めて行ったゴルフ場でも100を切るのを目標に、もし100切りできなければ後日リベンジしにいく、という感じでやっていた。その結果、2021年3月:87、5月:85、6月:84とベストスコアを伸ばすことができた。お気に入りのコースを5つ挙げるとしたらこの辺り。

  * [TPC Potomac at Avenel Farm](https://tpc.com/potomac/)
  * [Whiskey Creek](https://whiskeycreekgolf.com/golf/proto/whiskeycreekgolf/)
  * [Lake Presidential](https://www.lakepresidentialgolf.com/)
  * [P.B. Dye](https://www.pbdyegolf.com/)
  * [Little Bennett](https://www.mcggolf.com/courses/little-bennett)


* 料理

  アメリカ単身赴任という長期戦なので、運動とヘルシーな食生活は必須要素であり、当初から和・洋・中なんでも自炊していた。韓国系スーパーLotteでだいたいのものは揃うし、食材や調味料も無ければ近しいもので代用したり、想像力を働かせて試行錯誤しながら料理を作る工程はリサーチャーやエンジニアに向いていると思う。パエリャ、チャーシュー、クラブケーキ、ラムチョップ、坦々麺などから、サンフランシスコのクラスタシアンのローストクラブ再現まで、ワイン片手に日々料理をして美味しくいただくのは贅沢な時間でもあった。

* ピアノ

  COVID-19パンデミックで在宅時間も増えたことから、家でできる今までやったことのないことに挑戦してみようと電子ピアノを買ってみた。[flowkey](https://www.flowkey.com/)というサブスクで基礎の基礎から練習を初めた。楽譜の読み方から、指運びまで、コツコツと。自分の指の動かなさ加減に辟易として練習するのも嫌になることもあったけど、短い練習曲でも通しで弾けると物凄く達成感があって嬉しい。

* スポーツ観戦

  北米4大プロスポーツ(NFL、NHL、MLB、NBA)に加えてMLSも何度か観に行った。やっぱり会場で見るのは選手とファンの空気感も感じるし、TVで映っていないフィールドやコートの全体が見えて連動する動きなどとても勉強になる。在米中に、Nationalsは2019 World Serires Championsに輝いたし、Rui HachimuraのWizardsでの大活躍や、CapitalsのOvechkinは歴代得点ランキングをぐいぐいと昇る大活躍には、興奮するものがあった。宝田や横山が活躍するNWSLのSpiritを観にいけなかったのは残念。

## 3. 旅行

* [イエローストーン](/20190929_yellowstone.md)

* [アラスカ](/20210530_glacier_bay.md)

* ナイアガラ

* 落水荘

* シャーロッツビルのモンティチェロとバージニア大学


## 4. その他

* 洗車

* Thunderstorm

* DQW

* 整形外科、歯科


## 5. 帰国にあたって

* 物品の処分

* 諸々の解約


## 6. おわりに
アイテムだけ書き出したので、時間のある時に適宜更新して、最後にまとめる。
