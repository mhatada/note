# NIST Guest Researcherとしての米国勤務を終えて

[2019年3月に渡米](/20190526_settle_in_the_us.md)し、米国メリーランド州で[NIST](https://www.nist.gov/)のGuest Researcherとして研究活動を行なってきた。当初は1年の予定だったが、様々な理由から1年半延長したことによって、COVID-19パンデミック、TOKYO2020の延期開催、大統領選挙、17年ゼミBrood X襲来なども含め、2021年9月末までの間に仕事・生活の両面で様々な経験を積むことができた。これらの経験は今後誰かの役に立つかもしれないので、ここであらためて振り返ってまとめておく。

## 1. NISTでの研究
研究内容はそれぞれのリンク先等を参照してもらうものとして、ここでは研究の過程などを中心に記述する。全ての研究活動はNIST内のレポジトリで逐次共有し、ミーティングでもいつもMarkdownを見せながら文章と図で説明していたし、様々なツールや環境がすぐに利用できるのもとても快適な環境だった。

* An Empirical Study on Flow-based Botnet Attacks Prediction ([NIST TN 2111](https://csrc.nist.gov/publications/detail/white-paper/2020/10/22/an-empirical-study-on-flow-based-botnet-attacks-prediction/final))

  ボットネットのC2サーバのトラフィックを、ISPバックボーンのフローデータを用いて分析することで、ボットネットによる攻撃の予兆を検知する研究。IoTの普及に伴って脆弱な機器がインターネットに多数接続することによりボットネットの脅威があらためて深刻になっていた。2017年3月の大統領令[EO 13800]を受けて、2018年5月にDoCとDHS連名で発行した通称[Botnet Report](https://csrc.nist.gov/publications/detail/white-paper/2018/05/30/enhancing-resilience-against-botnets--report-to-the-president/final)などを踏まえ、スーパーバイザーのサポートのもと、研究テーマの立案から一人称で行なった。DivisionやGroupを超えて有識者にアイデアを紹介し、フィードバックをもらって方向性を定めるとともに、データ収集・分析のシステムの実装を並行して進めた。Deep Learningの適用とGPUクラスタの利用、ボットネットに関わる攻撃データをもとにしたアノテーションの自動化、Explainable AIとしての評価など、多くの新たなチャレンジもできた。日本では2021年10月5日に総務省から[「電気通信事業におけるサイバー攻撃への適正な対処の在り方に関する研究会　第四次とりまとめ」及び意見募集の結果の公表](https://www.soumu.go.jp/menu_news/s-news/01kiban18_01000134.html)が発表された。これは平時におけるフロー情報の収集・蓄積・分析によるC&Cサーバである可能性が高い機器の検知、フロー情報を収集・蓄積・分析して検知したC&Cサーバに関する情報についての共有などについての、通信の秘密の利用等に関する違法性阻却の考え方をまとめたものである。NISTでの研究成果が、国内でも活用していく布石になれば幸いだ。

* An Evaluation Design for Comparing Netflow Based Network Anomaly Detection Systems Using Synthetic Malicious Traffic([NIST TN 2142](https://www.nist.gov/publications/evaluation-design-comparing-netflow-based-network-anomaly-detection-systems-using))

  前述の研究の過程で議論したメンバから、コラボレーションの依頼があり、並行して取り組んだ。アノマリとなる攻撃データの合成、正常データとの混合、機械学習を用いた複数のアノマリ検知システムの比較評価を含む、フローベースのアノマリ検知システムの評価フレームワークを提案するものである。意見の食い違いも度々あり何度も議論したのは今となっては楽しい思い出である。攻撃データのパターンがDoSとかScanとかレガシーなものしかもともと合成していなかったので、ボットによる攻撃シミュレータ[BotSim](https://github.com/usnistgov/BotSim)を作った。そして、このTNの拡張としてBotSimも含めて研究成果をNIST在籍中にジャーナル投稿。ろくにリファクタリングもせずに公開するのは忍びなかったが、投稿段階で公開しておくべしという推しに負けて公開した。ちゃんと実装があるということを示す価値はあるかなと思う。

* CCE - SP800-53 mapping

  [Common Configuration Enumeration (CCE)](https://ncp.nist.gov/cce)は各種システムをセキュアに保つための共通的な設定の一覧であり、具体的なもの。[SP800-53](https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final)は米国の連邦政府が遵守すべき情報システムと組織のセキュリティとプライバシーの管理策であり、抽象的なもの。ガイドラインへの準拠状況を実装レベルで把握できるようにするために、各CCEとSP800-53の各管理策の対応付け（マッピング）を提供している。前述の研究がひと段落する頃、せっかくNISTにいるのだからとNISTならではのテーマに取り組みたいと思い、NVDのチームに混ぜてもらって、ちょっとやってみてと依頼されたのがこのマッピング。SP1800-19CのVMware Hybrid Cloud Infrastructureと、MacOSについてマッピングを行ったが、個々のプロダクトの機能の詳細知識が必要となり、マニュアルなども読み漁った。しかもN:Nのマッピングになるし、正解かどうかがわからない。そこで、マッピング結果の蓄積、キーワード検索、候補リストアップを行うインタラクティブなコマンドラインツールを作った。一貫性あるマッピングを複数名でやっていくためにはナレッジの蓄積とツール化が必要だと考える。ある程度マッピング結果が蓄積されていけば、NLP/MLを用いたリコメンデーションも可能となるだろうと思う。マッピングを通して、CCEやSP800-53への改善点をフィードバックしたり、NIST IR 8278のOLIR(Online Informative Refferences)による関係性の表記もとり入れたり、と興味深い仕事だった。

* NVD Analysis

  NVD分析チームが日々どんな環境で何をやっているかレクチャをしてもらった。NVDの透明性を担保するため、MITREやベンダから特別な情報提供を受けたりしていない、というのが最も驚いたことかもしれない。その上で、開発環境で約1.5ヶ月間かけてアナリストたちと同じようにMITREからの[CVEデータ](https://github.com/CVEProject/cvelist)に対して、参考情報の確認・追加、[CVSS](https://nvd.nist.gov/vuln-metrics/cvss)算出、[CWE](https://cwe.mitre.org/)特定、[CPE](https://csrc.nist.gov/projects/security-content-automation-protocol/specifications/cpe)特定をやってみた。大きくは3種類の課題をまとめ、メンバとディスカッションを行って、直近でも役立ちそうなCPE特定の自動化に向けた研究に着手することとした。まずは、[CVEデータ](https://github.com/CVEProject/cvelist)のJSONからCPEの元となるデータを自動的に抽出できるかどうか、想定されてる箇所にどんなデータが登録されているかを調査した上で、編集距離による類似度を用いた検索や、自然言語処理と機械学習を用いた他クラス分類、といった手法を試してみた。結果としては約88%の正答率で候補となる部分CPE群を導くことができた。また、この過程でCPE辞書の一括メンテナンスに応用できるノウハウや、自動化することでの一貫性あるCPE特定、そして入出力データ品質の継続的な評価の重要性が低減できたことも、具体的にNVDチームの役に立ったといえる。

帰国後には、ありがたいことにこれらの経験を共有する機会をいただいた。少なからずNISTが身近になったのではないかと密かに期待している。

  * [NCA Annual Conference 2021での基調講演](https://annualconf.nca.gr.jp/)

  * [MWS 2021ポストミーティングでの講演](http://www.iwsec.org/mws/2021/files/mws2021_PhD2NIST_hatada.pdf)


## 2. 趣味の広がり

* サッカー

  在米中、[Samurai Kids](https://samuraikids.wixsite.com/home)はサッカーだけでなく、ゴルフやBBQなどレジャーに限らず、生活面で必要な情報を教えてもらったり様々な面で貴重な場だった。メリーランド州モンゴメリー郡のリーグ戦に参戦しており、企業や研究機関の日本人中心に、結構ガチなサッカーができたのも思い出深い。新規メンバー募集のため、ホームページの立ち上げ、SNSの運用、掲示板への書き込みなど、ソーシャル面もアクティブに貢献できたと思う。チーム内の結果だけだが、得点王1回、アシスト王1回、投票によるMVPにも2回輝くことができ素直に嬉しかったし、40歳を過ぎてもまだこれだけ動けて、こういう経験ができることに喜びを感じた。

* ゴルフ

  COVID-19パンデミックで各種行動が制限される中、少人数かつオープンエアということでゴルフはほとんど制限もなく、これを機会にガッツリ始めた。最寄りのゴルフ場が車で20分だし、1時間圏内だとかなりの数のゴルフ場に行ける。ゴルフをする格好のまま行き、ゴルフバッグを担いでラウンド、というのが当たり前。上手い人たちからアドバイスもいただき、2020年8月に99で100切り達成し、9月:95、10月:90、11月:88と快調にベストスコアを更新。初めて行ったゴルフ場でも100を切るのを目標に、もし100切りできなければ後日リベンジしにいく、という感じでやっていた。その結果、2021年3月:87、5月:85、6月:84とベストスコアを伸ばすことができた。お気に入りのコースを5つ挙げるとしたらこの辺り。

  * [TPC Potomac at Avenel Farm](https://tpc.com/potomac/)
  * [Whiskey Creek](https://whiskeycreekgolf.com/golf/proto/whiskeycreekgolf/)
  * [Lake Presidential](https://www.lakepresidentialgolf.com/)
  * [P.B. Dye](https://www.pbdyegolf.com/)
  * [Little Bennett](https://www.mcggolf.com/courses/little-bennett)


* 料理

  アメリカ単身赴任という長期戦なので、運動とヘルシーな食生活は必須要素であり、当初から和・洋・中なんでも自炊していた。韓国系スーパーLotteでだいたいのものは揃うし、食材や調味料も無ければ近しいもので代用したり、想像力を働かせて試行錯誤しながら料理を作る工程はリサーチャーやエンジニアに向いていると思う。パエリャ、チャーシュー、クラブケーキ、ラムチョップ、坦々麺などから、サンフランシスコのクラスタシアンのローストクラブ再現まで、ワイン片手に日々料理をして美味しくいただくのは贅沢な時間でもあった。

* ピアノ

  COVID-19パンデミックで在宅時間も増えたことから、家でできる今までやったことのないことに挑戦してみようと電子ピアノを買ってみた。[flowkey](https://www.flowkey.com/)というサブスクで基礎の基礎から練習を初めた。楽譜の読み方から、指運びまで、コツコツと。自分の指の動かなさ加減に辟易として練習するのも嫌になることもあったけど、短い練習曲でも通しで弾けると物凄く達成感があって嬉しい。

* スポーツ観戦

  北米4大プロスポーツ(NFL、NHL、MLB、NBA)に加えてMLSも何度か観に行った。やっぱり会場で見るのは選手とファンの空気感も感じるし、TVで映っていないフィールドやコートの全体が見えて連動する動きなどとても勉強になる。在米中に、Nationalsは2019 World Serires Championsに輝いたし、Rui HachimuraのWizardsでの大活躍や、CapitalsのOvechkinは歴代得点ランキングをぐいぐいと昇る大活躍には、興奮するものがあった。宝田や横山が活躍するNWSLのSpiritを観にいけなかったのは残念。

## 3. 旅行

* [イエローストーン](/20190929_yellowstone.md)

  旅の記録はリンクから。また行きたい。

* [アラスカ](/20210530_glacier_bay.md)

  旅の記録はリンクから。また行きたい。

* ナイアガラ

  自宅から車で7時間ほどのナイアガラ。行こうと思えばいつでも行けると思ってたけどやっぱり行ってなくて、在米残り1.5ヶ月となってから決行。ペンシルバニア州の[Kinzua Bridge State Park](https://www.dcnr.pa.gov/StateParks/FindAPark/KinzuaBridgeStatePark/Pages/default.aspx)経由で、1日かけてドライブ。一緒に行ったご家族をマイカーに乗せてたこともあって、賑やかで楽しいロングドライブだった。ライトアップされたナイアガラの滝も青空の下で虹がかかったナイアガラの滝もとても壮大で気持ち良い。ボートにも乗ってビショビショ体験もしたし、大満足。帰りは違うルートで、ということでシラキュース大学にも寄り道し、フィラデルフィアではIndependence Hall(世界遺産)を巡り、ボルチモアでは何年か前に来たことがあるブルークラブを食べて、盛りだくさんの3泊4日だった。

* [落水荘](https://fallingwater.org/)

  フランク・ロイド・ライトの設計で作られた川の中に建てられたお家。2020年11月に紅葉狩りがてら、最寄りの世界遺産へ。9:00amのチケットしか残ってなかったから、まだ暗い5:30amに出発して約270kmを3hドライブで一番乗り。薄い石を積み重ねた地層のような壁と、丸みのある淡い黄土色の壁が良い感じに混ざり、川にせり出す感じといい、想像以上に素敵なお家でした。

* シャーロッツビルの[モンティチェロ](https://www.monticello.org/)とバージニア大学

  2021年9月、近所(といっても片道130マイル)の駆け込み世界遺産巡り。第3代アメリカ合衆国大統領トーマス・ジェファーソンのお家(Monticello)は静かな森の高台にあって庭園を散歩するだけでも気持ちいいし、彼が設立したバージニア大学では新入生たちがScavenger Huntやってて楽しそうで、周辺も学生たちの賑わいで活気があって良いとこでした。

## 4. その他

* 車

  知人から個人売買で入手したLexus HS250h。激しい雨が降ることも多く、大抵それで車は綺麗になるし、定期メンテでディーラーに持って行った時に洗車もしてくれていたので、自分で洗車する機会は無かった。とはいえせっかくだからガソリンスタンドにある洗車機に入ってみた。落ち着いてちゃんと案内を見てればなんてことはないんだけど、ちょっとドキドキ。冬になれば空気圧が下がるのでガソリンスタンドにある空気入れでタイヤの空気を入れたり、ワイパー交換したり、ウォッシャー液も補充したり、排ガス検査のためにMVAのセルフサービスのキオスクでODB接続したり、日本で自分でやらない様々な体験ができた。在米中、タイヤのパンクも含めて事故等がなくて本当に良かった。

* Thunderstorm

  激しい雷雨は夏の風物詩。オフィスに行っていた時は、地下のシェルターに避難する必要があり、安全意識の高さを凄く感じた。

* DQW

  モンスターが湧かない、回復スポットや選択できるストーリーの目的地がない、過酷な条件下でチマチマDQWをやっていた。強敵モンスターが2種類以上選べる時、1時間開ければ強敵モンスターを入れ替えると出現するという謎のハックは最大の発見だった。ひたすらスクロールして北米を横断し太平洋を横断しDQW上のマップで東京にたどり着いた時はとても感慨深買った。

* 歯科、整形外科

  できれば行く機会がないことを祈っていた病院系。それは突然訪れる。家でワインを飲みながらナッツを食べていると、、、奥歯の被せ物が外れた。翌日、Google Mapで検索して評判も良さげだった近所(徒歩圏)の歯医者に電話し予約して後日行ってみた。あれこれと丁寧に説明してくれたので不安は解消され、幸い接着剤が古くなって外れただけで虫歯にもなっていないとのことでクリーニングして型取りして選択肢なくセラミックの被せ物を2回目につけて終わった。$1,000超えてたが後々保険で全カバーされた。

  膝の痛みに耐えながらサッカーの春リーグ戦の後半を終えて、流石に病院に行った方が良いだろうと、Google Mapで検索して評判も良さげだった近所(車で10分)の整形外科へ。処方箋は電子的によく使うドラッグストア等に送られるのが当たり前らしく、受付でどこのドラッグストア？と聞かれたが使ったことないので決まってないと答えたら困惑された。結局近くのGiantの中のを指定しておいた。ドクターによる診察とレントゲン撮影により、「変形性膝関節症」「ベーカー嚢腫」と診断され、すぐに手術とかは必要ないけど、PT(Physical Therapy)を受けろと。週2回、PTに通い、膝周辺を強化するためのトレーニングを受け、おおむねマスターしたので1ヶ月くらいで、あとは自宅で自分で継続するように言われて卒業。

  予約、書類、専門用語、保険処理、もし万が一悪い状況だったら、などなど何かと不安になる病院系だったが、振り返ってみれば大したことではないようにさえ思える。

* 散髪

  渡米時に買って行ったヘアカット用のハサミで自分で切っていたので結局美容院とかには行かなかった。後ろとか髪をつまむ感触でちゃんと揃えて切れるくらいになったので我ながら
  大したものだ。


## 5. 帰国にあたって

* 物品の処分

  サッカーのメンバ、[掲示板](http://www.kaigailink.com/cgi-bin/board-dc-4class09/query.cgi)、[OfferUp](https://offerup.com/)で、日本に持って帰らないものをどんどん売った。なんだかんだ日本人の持ち物を日本人には安心して買ってもらえたりするし楽チンだった。OfferUpは知らない人とチャットして受け渡し日時場所を決めたり、当日現金引き渡ししていたのでちょっと面倒だけど意外と何でも売れた。

* 諸々の解約

  渡米後に登録した様々なサービスなどをiCloudのNoteにリストアップしていたので助かった。Washington Gasだけはひたすら電話は繋がら図、twitterでも苦情がたくさん出ててどうしようかと思ったが、探し出したメールアドレスにメールしたら数日で返事があり解約もできた。返金があるものはクレジットカードに返金されるか、小切手が郵送されるので、早めに知人宅等を当面の住所として変更手続きをしておくと何かと便利。とはいえ、一番額の大きかったアパートのデポジットの返金小切手が郵送で届かなかったり、メールでやりとりしていた担当者が産休と突然連絡がとれなくなったり、なんだかんだ5ヶ月後にようやく受領できた。


## 6. おわりに

2.5年の在米生活のうち、1.5年はCOVID-19パンデミックで在宅勤務だったり想定外のことも多かったが、その分新たにチャレンジできたこともあったし、濃密な時間を過ごすことができたと思う。

仕事をする上では博士学位があることで一定の専門性があるという前提で議論ができるので、ある種の障壁を下げるのには役立ったと思う。サイバーセキュリティの専門知識があって機械学習も使いこなせると、やれることはたくさんあってまだまだやってみたいことはあったが、何よりも技術面で通用した(と思える)のは自分にとっても大きな自信になった。

英語の面では生活を通じて慣れるというのは大きい。要するに、どんなシーンでどんな会話があるか、自分が言いたいことは何か、日本語でも英語でもその想像力や意見がなければ相槌しか打てない。そして多くの場合、フレーズはいくつかのパターンでカバーできて、動詞や目的語となる名詞のバリエーションが増えれば表現力が上がる（より適切な表現ができる）。

仕事も遊びも充実することができたのは、仲間がいたからこそととても感謝している。いつか出張で、旅行で、あるいは赴任で、またここに来ることを心から楽しみにしている。今後も誰かに尋ねられたりして、ふと思い出したことを追記していこうと思う。
